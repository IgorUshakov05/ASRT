# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è backend-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
–°–∞–π—Ç - https://igorushakov.ru/
## 1. –û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞–º–∏ (—Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞–º–∏) –≤—Å—Ç—Ä–µ—á –∏–∑ Fireflies.ai. –û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –≤–∫–ª—é—á–∞–µ—Ç:

- –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –≤—Å—Ç—Ä–µ—á–∏ (–Ω–∞–∑–≤–∞–Ω–∏–µ, —Å—Å—ã–ª–∫–∞) –ø–æ ID –∏–ª–∏ URL —á–µ—Ä–µ–∑ Fireflies.ai API (GraphQL).
- –°–æ–∑–¥–∞–Ω–∏–µ Google Sheets —Ñ–∞–π–ª–∞ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º –≤—Å—Ç—Ä–µ—á–∏ –≤ –æ–±—â–µ–º Google Drive –¥–∏—Å–∫–µ.
- –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞, —Ä–∞–∑–±–∏—Ç–æ–≥–æ –ø–æ —Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –±–ª–æ–∫–∞–º.
- –ó–∞–ø–∏—Å—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ Google —Ç–∞–±–ª–∏—Ü—É —Å –∑–∞–¥–∞–Ω–Ω—ã–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º.
- –í–æ–∑–≤—Ä–∞—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å—Å—ã–ª–∫–∏ –Ω–∞ —Å–æ–∑–¥–∞–Ω–Ω—ã–π Google Sheets —Ñ–∞–π–ª.

## 2. –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∏ —Å–µ—Ä–≤–∏—Å—ã

- **Fireflies.ai API**: –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–æ–≤ –≤—Å—Ç—Ä–µ—á.
- **Google Sheets API**: –°–æ–∑–¥–∞–Ω–∏–µ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Google —Ç–∞–±–ª–∏—Ü.
- **Google Drive API**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞–º–∏ –≤ –æ–±—â–µ–º Google Drive.
- **Express.js**: –í–µ–±-—Å–µ—Ä–≤–µ—Ä –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è.
- **Axios**: –û—Ç–ø—Ä–∞–≤–∫–∞ HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Fireflies.ai API.
- **dotenv**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è.
- **React**: –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤.
- **React Query**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ.

## 3. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

- **–ú–∞—Ä—à—Ä—É—Ç**: `/api/v1/create` ‚Äî —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è Google Sheets –ø–æ —Å—Å—ã–ª–∫–µ –Ω–∞ –≤—Å—Ç—Ä–µ—á—É.
- **–ú–æ–¥—É–ª–∏**:
  - `firefile.js`: –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å Fireflies.ai API.
  - `googlesheets.js`: –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ —Ä–∞–±–æ—Ç–∞ —Å Google Sheets –∏ Google Drive API.
  - `uploadRouter`: –ó–∞–≥—Ä—É–∑–∫–∞ –∞—É–¥–∏–æ—Ñ–∞–π–ª–æ–≤ (–Ω–µ –≤—Ö–æ–¥–∏—Ç –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã).
- **–°—Ä–µ–¥–∞**: Node.js —Å Express.

## 4. –û–ø–∏—Å–∞–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞ `/api/v1/create`

### 4.1 –í—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

- `url`: –°—Å—ã–ª–∫–∞ –Ω–∞ –≤—Å—Ç—Ä–µ—á—É Fireflies.ai (–Ω–∞–ø—Ä–∏–º–µ—Ä, `https://fireflies.ai/view/meeting:12345abcdef`).

### 4.2 –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

1. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ ID –≤—Å—Ç—Ä–µ—á–∏ –∏–∑ URL (–ø–∞—Ä—Å–∏–Ω–≥ –ø–æ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—é `:`).
2. –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –≤—Å—Ç—Ä–µ—á–∏ —á–µ—Ä–µ–∑ GraphQL Fireflies.ai. –ï—Å–ª–∏ –≤—Å—Ç—Ä–µ—á–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞.
3. –°–æ–∑–¥–∞–Ω–∏–µ Google Sheets —Ñ–∞–π–ª–∞ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º –≤—Å—Ç—Ä–µ—á–∏ –≤ –æ–±—â–µ–º –¥–∏—Å–∫–µ Google Drive.
4. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–∞–∑–±–∏—Ç–æ–≥–æ –ø–æ —Ç–µ–º–∞–º —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞ –≤—Å—Ç—Ä–µ—á–∏.
5. –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –≤ Google Sheets —Å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º.
6. –í–æ–∑–≤—Ä–∞—Ç –æ—Ç–≤–µ—Ç–∞ –∫–ª–∏–µ–Ω—Ç—É —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ–± —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏ —Å—Å—ã–ª–∫–æ–π –Ω–∞ —Ç–∞–±–ª–∏—Ü—É.

## 5. –ú–æ–¥—É–ª—å Fireflies.ai API (`firefile.js`)

### 5.1 –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```js
const API_KEY = process.env.FIRE_API_KEY;
const GRAPHQL_URL = "https://api.fireflies.ai/graphql";

const headers = {
  "Content-Type": "application/json",
  Authorization: `Bearer ${API_KEY}`,
};
```

### 5.2 –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≤—Å—Ç—Ä–µ—á–µ

```js
async function getInfoAboutMeet(id) {
  try {
    const data = {
      query: `
        query Transcript($transcriptId: String!) {
          transcript(id: $transcriptId) {
            id
            title
            transcript_url
          }
        }`,
      variables: { transcriptId: id },
    };

    const response = await axios.post(GRAPHQL_URL, data, { headers });
    if (response.data.errors)
      return { success: false, message: response.data.errors[0].message };
    const transcriptData = response.data.data.transcript;
    return { success: true, transcriptData };
  } catch (e) {
    console.error("Error in GraphQL:", e.response?.data || e.message);
    return { success: false, message: e.response?.data?.errors?.[0]?.message || e.message };
  }
}
```

### 5.3 –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞ –ø–æ ID

```js
async function getTranscriptById(id) {
  const query = `
    query Transcript($id: String!) {
      transcript(id: $id) {
        summary {
          outline
          shorthand_bullet
        }
      }
    }
  `;

  const variables = { id };

  try {
    const res = await axios.post(
      GRAPHQL_URL,
      { query, variables },
      { headers }
    );
    if (res.data.errors)
      return { success: false, message: res.data.errors[0].message };

    const summary = res.data.data.transcript.summary;
    const rawText = summary.shorthand_bullet || summary.outline || "";

    const parts = rawText.split(/\n(?=üìà|‚ö†Ô∏è|‚è≥|ü§ù|üîç)/);

    const data = parts.map((part) => {
      const firstLineEnd = part.indexOf("\n");
      let stage, script;

      if (firstLineEnd !== -1) {
        stage = part
          .substring(0, firstLineEnd)
          .replace(/[\u{1F300}-\u{1FAFF}]/gu, "")
          .trim();
        script = part.substring(firstLineEnd + 1).trim();
      } else {
        stage = part.trim();
        script = "";
      }

      stage = stage.replace(/\(?:\d{2}:\d{2} - \d{2}:\d{2}\)/, "").trim();

      return { stage, script };
    });

    return { success: true, data };
  } catch (error) {
    console.error("–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞:", error);
    return {
      success: false,
      message: "–¢–µ–∫—É—â–∏–π —Ç–∞—Ä–∏—Ñ –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —ç—Ç–æ–π —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏",
    };
  }
}
```

## 6. –ú–æ–¥—É–ª—å Google Sheets –∏ Drive API (`googlesheets.js`)

### 6.1 –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

```js
const { google } = require("googleapis");
const path = require("path");

async function authorize() {
  const auth = new google.auth.GoogleAuth({
    keyFile: path.resolve(__dirname, "./credentials.json"),
    scopes: [
      "https://www.googleapis.com/auth/drive",
      "https://www.googleapis.com/auth/spreadsheets",
    ],
  });

  return await auth.getClient();
}
```

### 6.2 –°–æ–∑–¥–∞–Ω–∏–µ Google Sheets —Ñ–∞–π–ª–∞

```js
async function createFiles(title) {
  const authClient = await authorize();
  const drive = google.drive({ version: "v3", auth: authClient });

  const folderId = "ID_–û–ë–©–ï–ì–û_–î–ò–°–ö–ê";

  try {
    const sheetRes = await drive.files.create({
      requestBody: {
        name: title,
        mimeType: "application/vnd.google-apps.spreadsheet",
        parents: [folderId],
      },
      supportsAllDrives: true,
      fields: "id, name, parents",
    });

    const sheetLink = `https://docs.google.com/spreadsheets/d/${sheetRes.data.id}`;
    return { success: true, id: sheetRes.data.id, link: sheetLink };
  } catch (error) {
    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ñ–∞–π–ª–∞:", error);
    return { success: false };
  }
}
```

### 6.3 –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –≤ —Ç–∞–±–ª–∏—Ü—É —Å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º

```js
async function writeFile(spreadsheetId, data) {
  const authClient = await authorize();
  const sheets = google.sheets({ version: "v4", auth: authClient });

  const values = [
    ["‚Ññ", "–≠—Ç–∞–ø", "–°–∫—Ä–∏–ø—Ç"],
    ...data.map((item, index) => [index + 1, item.stage, item.script]),
  ];

  const grayColor = { red: 0.6, green: 0.6, blue: 0.6 };
  const whiteColor = { red: 1, green: 1, blue: 1 };

  try {
    await sheets.spreadsheets.values.update({
      spreadsheetId,
      range: "Sheet1!A1",
      valueInputOption: "RAW",
      requestBody: { values },
    });

    await sheets.spreadsheets.batchUpdate({
      spreadsheetId,
      requestBody: {
        requests: [
          {
            repeatCell: {
              range: {
                sheetId: 0,
                startRowIndex: 0,
                endRowIndex: 1,
                startColumnIndex: 0,
                endColumnIndex: 3,
              },
              cell: {
                userEnteredFormat: {
                  backgroundColor: grayColor,
                  textFormat: { bold: true, foregroundColor: whiteColor },
                  horizontalAlignment: "CENTER",
                  verticalAlignment: "MIDDLE",
                },
              },
              fields: "userEnteredFormat(backgroundColor,textFormat,horizontalAlignment,verticalAlignment)",
            },
          },
          {
            repeatCell: {
              range: {
                sheetId: 0,
                startRowIndex: 1,
                endRowIndex: values.length,
                startColumnIndex: 0,
                endColumnIndex: 2,
              },
              cell: {
                userEnteredFormat: {
                  backgroundColor: grayColor,
                  textFormat: { bold: true, foregroundColor: whiteColor },
                  horizontalAlignment: "CENTER",
                  verticalAlignment: "MIDDLE",
                },
              },
              fields: "userEnteredFormat(backgroundColor,textFormat,horizontalAlignment,verticalAlignment)",
            },
          },
          {
            repeatCell: {
              range: {
                sheetId: 0,
                startRowIndex: 1,
                endRowIndex: values.length,
                startColumnIndex: 2,
                endColumnIndex: 3,
              },
              cell: {
                userEnteredFormat: {
                  backgroundColor: grayColor,
                  textFormat: { bold: false, foregroundColor: whiteColor },
                  horizontalAlignment: "LEFT",
                  verticalAlignment: "MIDDLE",
                },
              },
              fields: "userEnteredFormat(backgroundColor,textFormat,horizontalAlignment,verticalAlignment)",
            },
          },
        ],
      },
    });

    return { success: true };
  } catch (error) {
    console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü—É:", error);
    return { success: false };
  }
}
```

## 7. –ü—Ä–∏–º–µ—Ä –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞

```js
require("dotenv").config();
const express = require("express");
const cors = require("cors");
const morgan = require("morgan");
const uploadRouter = require("./API/routes/upload");
const routerCreateSheet = require("./API/routes/createSheet");

const app = express();
app.use(morgan("dev"));
app.use(cors());
app.use("/api/v1", uploadRouter);
app.use("/api/v1", routerCreateSheet);

app.get("/", (req, res) => {
  res})();

app.listen(process.env.PORT, () => {
  console.log(`Server started at ${process.env.URL}:${process.env.PORT}`);
});
```

## 8. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (`.env`)

```.env
FIRE_API_KEY=your_fireflies_api_key
PORT=3000
URL=http://localhost
```

## 9. –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

- ID –ª–∏—Å—Ç–∞ Google Sheets (`sheetId`) –æ–±—ã—á–Ω–æ —Ä–∞–≤–µ–Ω 0 –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –ª–∏—Å—Ç–∞.
- –ü—Ä–∞–≤–∞ —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ Google –¥–æ–ª–∂–Ω—ã –≤–∫–ª—é—á–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫ –æ–±—â–µ–º—É –¥–∏—Å–∫—É (shared drive).
- Fireflies.ai API –∏–º–µ–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ —Ç–∞—Ä–∏—Ñ—É ‚Äî –æ—à–∏–±–∫–∏ "Too many requests" –∏–ª–∏ "subscription level" –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ.
- –¢–µ–∫—Å—Ç –≤ —è—á–µ–π–∫–∞—Ö Google Sheets –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —á–∞—Å—Ç–∏—á–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∂–∏—Ä–Ω–æ—Å—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å–ª–æ–≤).
- –ü–∞—Ä—Å–∏–Ω–≥ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç–º–æ–¥–∑–∏-–º–∞—Ä–∫–µ—Ä—ã –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –Ω–∞ —Ç–µ–º—ã, –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è.
